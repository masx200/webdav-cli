{"version":3,"file":"webdav-cli.cli.js","sources":["../src/create-http-auth.ts","../src/createbasicauth.ts","../src/createdigestauth.ts","../src/webdav-cli.constants.ts","../src/webdav-cli.utils.ts","../src/webdav-cli.server.ts","../src/createhttpauthmiddle.ts","../src/beforelogger.ts","../src/propfindchecker.ts","../src/koa-static-server.ts","../src/afterlogger.ts","../src/main.ts","../src/showhelp.ts","../src/webdav-cli.cli.ts"],"sourcesContent":["import { v2 as webdav } from \"webdav-server\";\n//@ts-ignore\nimport { createbasicauth } from \"./createbasicauth.js\";\nimport { createdigestauth } from \"./createdigestauth.js\";\n\nexport function createhttpauth(options: {\n    user: string;\n    pass: string;\n    authentication: \"HTTPDigestAuthentication\" | \"HTTPBasicAuthentication\";\n}) {\n    const realm = \"Default realm\";\n    const auth =\n        options.authentication === \"HTTPBasicAuthentication\"\n            ? createbasicauth(realm, options.user, options.pass)\n            : createdigestauth(realm, options.user, options.pass);\n    return (ctx: webdav.HTTPRequestContext, next: () => void) => {\n        auth.check((req, res) => {\n            next();\n        })(ctx.request, ctx.response);\n    };\n}\n","import httpauth from \"http-auth\";\n\nexport function createbasicauth(\n    realm: string,\n    user: string,\n    pass: string,\n): ReturnType<typeof httpauth.basic> {\n    return httpauth.basic(\n        {\n            realm,\n        },\n        (username, password, callback) => {\n            // Custom authentication method.\n            callback(username === user && password === pass);\n        },\n    );\n}\n","import httpauth from \"http-auth\";\n//@ts-ignore\nimport utils from \"http-auth/src/auth/utils.js\";\n\nexport function createdigestauth(\n    realm: string,\n    user: string,\n    pass: string,\n): ReturnType<typeof httpauth.digest> {\n    return httpauth.digest(\n        {\n            realm,\n        },\n        // Expecting md5(username:realm:password) in callback.\n        (username, callback) => {\n            if (username === user) {\n                callback(utils.md5(`${username}:${realm}:${pass}`));\n            } else {\n                callback();\n            }\n        },\n    );\n}\n","import { WebdavCliRights } from \"./webdav-cli.interfaces\";\n\n// export const HOMEPAGE = 'https://github.com/svtslv/webdav-cli';\n\nexport const RIGHTS: WebdavCliRights = [\n    \"all\",\n    \"canCreate\",\n    \"canDelete\",\n    \"canMove\",\n    \"canRename\",\n    \"canAppend\",\n    \"canWrite\",\n    \"canRead\",\n    \"canSource\",\n    \"canGetMimeType\",\n    \"canGetSize\",\n    \"canListLocks\",\n    \"canSetLock\",\n    \"canRemoveLock\",\n    \"canGetAvailableLocks\",\n    \"canGetLock\",\n    \"canAddChild\",\n    \"canRemoveChild\",\n    \"canGetChildren\",\n    \"canSetProperty\",\n    \"canGetProperty\",\n    \"canGetProperties\",\n    \"canRemoveProperty\",\n    \"canGetCreationDate\",\n    \"canGetLastModifiedDate\",\n    \"canGetWebName\",\n    \"canGetType\",\n];\n","export function getRandomString(length: number) {\n    return [...Array(Math.ceil(length / 8))]\n        .map(() => Math.random().toString(36).slice(-8))\n        .join(\"\")\n        .slice(-length);\n}\n","import fs from \"fs\";\nimport http from \"http\";\nimport https from \"https\";\nimport { dirname, join } from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { v2 as webdav } from \"webdav-server\";\nimport { afterlogger } from \"./afterlogger.js\";\nimport { beforelogger } from \"./beforelogger.js\";\nimport { createhttpauthmiddle } from \"./createhttpauthmiddle.js\";\nimport { koa_static_server } from \"./koa-static-server.js\";\nimport { propfindchecker } from \"./propfindchecker.js\";\nimport { RIGHTS } from \"./webdav-cli.constants.js\";\nimport { WebdavCliConfig, WebdavCliRights } from \"./webdav-cli.interfaces.js\";\nimport { getRandomString } from \"./webdav-cli.utils.js\";\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\nexport class WebdavCli {\n    config: WebdavCliConfig;\n    server: webdav.WebDAVServer;\n    #auth_middle: (ctx: webdav.HTTPRequestContext, next: () => void) => void;\n    constructor(config: Partial<WebdavCliConfig>) {\n        this.config = this.#getConfig(config);\n        const authentication = this.#get_authentication(this.config);\n        const auth_middle = createhttpauthmiddle(\n            this.config.username,\n            this.config.password,\n            authentication,\n        );\n        this.#auth_middle = auth_middle;\n        this.server = this.#init();\n    }\n\n    #getConfig(config: Partial<WebdavCliConfig>): WebdavCliConfig {\n        const selfSignedKey = join(__dirname, \"/../certs/self-signed.key.pem\");\n        const selfSignedCert = join(\n            __dirname,\n            \"/../certs/self-signed.cert.pem\",\n        );\n\n        const path = config.path || process.cwd();\n        const host = config.host || \"0.0.0.0\";\n        const port = config.port || 1900;\n\n        const digest = Boolean(config.digest);\n        let username = (config.username || getRandomString(16)).toString();\n        let password = (config.password || getRandomString(16)).toString();\n\n        const ssl = Boolean(config.ssl);\n        const sslKey = ssl\n            ? fs.readFileSync(config.sslKey || selfSignedKey).toString()\n            : \"\";\n        const sslCert = ssl\n            ? fs.readFileSync(config.sslCert || selfSignedCert).toString()\n            : \"\";\n\n        const disableAuthentication = Boolean(config.disableAuthentication);\n\n        if (disableAuthentication) {\n            config.rights = config.rights || [\"canRead\"];\n            username = \"\";\n            password = \"\";\n        }\n\n        const rights = (config.rights || [\"all\"]).filter(\n            (item: WebdavCliRights[number]) => RIGHTS.includes(item),\n        );\n        const url = `${ssl ? \"https\" : \"http\"}://${host}:${port}`;\n\n        return {\n            ...config,\n            host,\n            path,\n            port,\n            username,\n            digest,\n            password,\n            ssl,\n            sslCert,\n            sslKey,\n            rights,\n            url,\n            disableAuthentication,\n        };\n    }\n\n    #init(): webdav.WebDAVServer {\n        const config = this.config;\n\n        const userManager = new webdav.SimpleUserManager();\n        const user = userManager.addUser(\n            config.username,\n            config.password,\n            false,\n        );\n\n        const privilegeManager = new webdav.SimplePathPrivilegeManager();\n        privilegeManager.setRights(user, \"/\", config.rights);\n\n        const options = {\n            requireAuthentification: false,\n            httpAuthentication:\n                // config.disableAuthentication\n                // ?\n                {\n                    askForAuthentication: () => ({}),\n                    getUser: (\n                        ctx: any,\n                        gotUserCallback: (\n                            arg0: Error,\n                            arg1: webdav.IUser,\n                        ) => void,\n                    ) => {\n                        userManager.getDefaultUser((defaultUser) => {\n                            privilegeManager.setRights(\n                                defaultUser,\n                                \"/\",\n                                config.rights,\n                            );\n                            //@ts-ignore\n                            gotUserCallback(null, defaultUser);\n                        });\n                    },\n                },\n            //     :\n            //     new webdav[authentication](userManager, \"Default realm\"),\n            // privilegeManager: privilegeManager,\n            // https: config.ssl\n            //     ? { cert: config.sslCert, key: config.sslKey }\n            //     : undefined,\n            port: config.port,\n            hostname: config.host,\n        };\n        config.ssl &&\n            Reflect.set(options, \"https\", {\n                cert: config.sslCert,\n                key: config.sslKey,\n            });\n        const server = new webdav.WebDAVServer(options);\n\n        server.beforeRequest(beforelogger());\n        if (!config.disableAuthentication) {\n            const auth_middle = this.#auth_middle;\n            if (\n                Array.isArray(this.config.methodsWithoutAuthentication) &&\n                this.config.methodsWithoutAuthentication.length\n            ) {\n                server.beforeRequest((ctx, next): void => {\n                    if (\n                        ctx.request.method &&\n                        this.config.methodsWithoutAuthentication?.includes(\n                            ctx.request.method,\n                        )\n                    ) {\n                        next();\n                    } else {\n                        auth_middle(ctx, next);\n                    }\n                });\n            } else {\n                server.beforeRequest(auth_middle);\n            }\n        } else {\n            server.beforeRequest((ctx, next) => {\n                const readonly_methods = [\"GET\", \"HEAD\", \"PROPFIND\", \"OPTIONS\"];\n                if (\n                    ctx.request.method &&\n                    readonly_methods.includes(ctx.request.method)\n                ) {\n                    next();\n                } else {\n                    ctx.setCode(405);\n                    ctx.exit();\n                }\n            });\n        }\n        server.beforeRequest(propfindchecker());\n        server.beforeRequest(koa_static_server(config.path));\n        server.afterRequest(afterlogger());\n\n        return server;\n    }\n    #get_authentication(config: WebdavCliConfig) {\n        return config.digest\n            ? \"HTTPDigestAuthentication\"\n            : \"HTTPBasicAuthentication\";\n    }\n\n    async start() {\n        const config = this.config;\n        const { server } = this;\n        console.log(\n            Object.fromEntries(\n                Object.entries(config).filter(([key]) => {\n                    return ![\"sslKey\", \"sslCert\"].includes(key);\n                }),\n            ),\n        );\n        await server.setFileSystemAsync(\n            \"/\",\n            new webdav.PhysicalFileSystem(config.path),\n        );\n        const logs = [\n            `Server running at ${config.url}`,\n\n            \"Hit CTRL-C to stop the server\",\n            \"Run with --help to print help\",\n        ];\n\n        console.log(logs.join(\"\\n\"));\n        let rawhttpserver: http.Server | https.Server | undefined = undefined;\n\n        Object.defineProperty(server, \"server\", {\n            get() {\n                return rawhttpserver;\n            },\n            set(v) {\n                rawhttpserver = v;\n                if (!rawhttpserver) {\n                    return;\n                }\n                rawhttpserver.on(\"error\", (err) => {\n                    if (Reflect.get(err, \"code\") === \"EADDRINUSE\") {\n                        console.error(err);\n                        rawhttpserver?.listen(\n                            Math.round(Math.random() * 65535),\n                            config.host,\n                        );\n                        return;\n                    } else {\n                        throw err;\n                    }\n                });\n                rawhttpserver.on(\"listening\", () => {\n                    console.log(\n                        `Server listening on ` +\n                            JSON.stringify(rawhttpserver?.address()),\n                    );\n                });\n\n                return;\n            },\n            enumerable: true,\n            configurable: true,\n        });\n\n        await server.startAsync(config.port);\n    }\n}\nexport type HTTPRequestContext = webdav.HTTPRequestContext;\n","import { HTTPRequestContext } from \"./index\";\nimport { createhttpauth } from \"./create-http-auth.js\";\n\nexport function createhttpauthmiddle(\n    username: string,\n    password: string,\n    authentication: \"HTTPDigestAuthentication\" | \"HTTPBasicAuthentication\",\n): (ctx: HTTPRequestContext, next: () => void) => void {\n    return createhttpauth({\n        user: username,\n        pass: password,\n        authentication,\n    });\n}\n","import { HTTPRequestContext } from \"./webdav-cli.server.js\";\n\nexport function beforelogger() {\n    return async (ctx: HTTPRequestContext, next: () => void) => {\n        const { url, headers, method } = ctx.request;\n        console.log(\">> \", method, url, headers);\n        next();\n    };\n}\n","import { HTTPRequestContext } from \"./webdav-cli.server.js\";\n\nexport function propfindchecker() {\n    return (arg: HTTPRequestContext, next: () => void) => {\n        const { headers, method } = arg.request;\n        const { depth } = headers;\n        if (method === \"PROPFIND\" && depth !== \"0\" && depth !== \"1\") {\n            arg.setCode(403);\n            arg.exit();\n        } else {\n            next();\n        }\n    };\n}\n","//@ts-ignore\nimport Koa from \"koa\";\nimport logger from \"koa-logger\";\nimport { v2 as webdav } from \"webdav-server\";\n//@ts-ignore\nimport { loadcoremiddles } from \"@masx200/serve-cli\";\nexport function koa_static_server(publicpath: string) {\n    const app = new Koa();\n    // app.use(async (ctx, next) => {\n    //     ctx.response.set(\"Access-Control-Allow-Origin\", \"*\");\n    //     return next();\n    // });\n\n    // app.use(async (ctx, next) => {\n    //     await next();\n    //     if (ctx.method === \"HEAD\") {\n    //         ctx.res.end();\n    //     }\n    //     return;\n    // });\n    // app.use(range);\n    // app.use(cors({}));\n    app.use(logger());\n    // app.use(conditional());\n\n    // app.use(compress({}));\n    // app.use(streametag({}));\n    // app.use(koaetag({}));\n    // app.use(serveIndex(publicpath, { hidden: true }));\n    // app.use(servestatic(publicpath, { hidden: true }));\n    loadcoremiddles(app, publicpath, false);\n    const serverHandler = app.callback();\n    return function middleware(\n        ctx: webdav.HTTPRequestContext,\n        next: () => void,\n    ) {\n        const { request, response } = ctx;\n        const [req, res] = [request, response];\n        if (\n            ctx.request.method &&\n            ![\"GET\", \"HEAD\"].includes(ctx.request.method)\n        ) {\n            return next();\n        }\n        serverHandler(req, res);\n\n        return;\n    };\n}\n","import { HTTPRequestContext } from \"./webdav-cli.server.js\";\n\nexport function afterlogger() {\n    return (arg: HTTPRequestContext, next: () => void) => {\n        const log = `>> ${arg.request.method} ${arg.requested.uri} > ${arg.response.statusCode} `;\n        // server.emit('log', null, null, '/', log);\n        console.log(log);\n        next();\n    };\n}\n","import process from \"process\";\nimport minimist from \"minimist\";\nimport { WebdavCli } from \"./webdav-cli.server.js\";\nimport { showhelp } from \"./showhelp.js\";\nimport { WebdavCliConfig } from \"./webdav-cli.interfaces.js\";\n\nexport async function main(\n    argv: Partial<WebdavCliConfig & minimist.ParsedArgs>,\n) {\n    console.log(\"webdav-cli\", \"\\n\");\n    if (argv.help || argv.h) {\n        showhelp();\n    }\n    // if (argv.version || argv.v) {\n    //     console.log(\"Version: \" + require(\"../package.json\").version, \"\\n\");\n    //     process.exit();\n    // }\n    const rights = argv.rights || argv.r;\n    const argvRights =\n        rights && typeof rights === \"string\" ? rights.split(\",\") : undefined;\n    const envRights = process.env.WEBDAV_CLI_RIGHTS\n        ? process.env.WEBDAV_CLI_RIGHTS.split(\",\")\n        : undefined;\n    const config = {\n        path: argv.path || process.env.WEBDAV_CLI_PATH || argv.pa,\n        host: argv.host || process.env.WEBDAV_CLI_HOST || argv.ho,\n        port:\n            Number(argv.port || argv.po) ||\n            parseInt(String(process.env.WEBDAV_CLI_PORT)),\n        digest:\n            argv.digest || argv.dg || Boolean(process.env.WEBDAV_CLI_DIGEST),\n        username: argv.username || process.env.WEBDAV_CLI_USERNAME || argv.u,\n        password: argv.password || process.env.WEBDAV_CLI_PASSWORD || argv.ps,\n        ssl: argv.ssl || argv.s || Boolean(process.env.WEBDAV_CLI_SSL),\n        sslKey: argv.sslKey || process.env.WEBDAV_CLI_SSL_KEY,\n        sslCert: argv.sslCert || process.env.WEBDAV_CLI_SSL_CERT,\n        disableAuthentication:\n            argv.disableAuthentication ||\n            process.env.WEBDAV_CLI_DISABLE_AUTHENTICATION ||\n            argv.da,\n        rights: argvRights || envRights,\n        methodsWithoutAuthentication:\n            \"string\" === typeof argv.methodsWithoutAuthentication\n                ? String(argv.methodsWithoutAuthentication).split(\",\")\n                : Array.isArray(argv.methodsWithoutAuthentication)\n                ? argv.methodsWithoutAuthentication\n                : undefined,\n    };\n    process.on(\"unhandledRejection\", (e) => {\n        console.error(e);\n        throw e;\n    });\n    const run = async () => {\n        //@ts-ignore\n        const webdavCli = new WebdavCli(config);\n        await webdavCli.start();\n        return webdavCli;\n    };\n    return await run();\n}\n","import process from \"process\";\nexport function showhelp() {\n    console.log(\n        [\n            \"usage: webdav-cli [options]\",\n            \"\",\n            \"options:\",\n            \"  --path,-pa        Path to folder [process.cwd()]\",\n            \"  --host,-ho         Host to use [0.0.0.0]\",\n            \"  --port,-po       Port to use [1900]\",\n            \"  --digest,-dg     Enable digest authentication [basic]\",\n            \"  --username,-u   Username for basic/digest authentication [random]\",\n            \"  --password,-ps   Password for basic/digest authentication [random]\",\n            \"  --disableAuthentication,-da  The server file becomes read-only without Authentication.[false]\",\n            \"  --ssl,-s        Enable https [false]\",\n            \"  --methodsWithoutAuthentication          methods Without Authentication[undefined]\",\n            \"  --sslKey     Path to ssl key file [self-signed]\",\n            \"  --sslCert    Path to ssl cert file [self-signed]\",\n            \"  --help,-h       Print this list and exit\",\n            // \"  --version,-v     Print the version and exit.\",\n            \"  --rights,-r     Comma separated values without spaces [all]\",\n            `\n    'all', 'canCreate', 'canDelete', 'canMove', 'canRename', \n    'canAppend', 'canWrite', 'canRead', 'canSource', \n    'canGetMimeType', 'canGetSize', 'canListLocks', \n    'canSetLock', 'canRemoveLock', 'canGetAvailableLocks', \n    'canGetLock', 'canAddChild', 'canRemoveChild', \n    'canGetChildren', 'canSetProperty', 'canGetProperty', \n    'canGetProperties', 'canRemoveProperty', 'canGetCreationDate', \n    'canGetLastModifiedDate', 'canGetWebName', 'canGetType'`,\n            \"\",\n            \"env:\",\n            \"  WEBDAV_CLI_PATH, WEBDAV_CLI_HOST, WEBDAV_CLI_PORT,\",\n            \"  WEBDAV_CLI_USERNAME, WEBDAV_CLI_PASSWORD, WEBDAV_CLI_DIGEST,\",\n            \"  WEBDAV_CLI_SSL, WEBDAV_CLI_SSL_KEY, WEBDAV_CLI_SSL_CERT,\",\n            \"  WEBDAV_CLI_AUTO_INDEX, WEBDAV_CLI_RIGHTS\",\n            \"  WEBDAV_CLI_DISABLE_AUTHENTICATION\",\n            \"\",\n        ].join(\"\\n\"),\n    );\n    process.exit();\n}\n","import { main } from \"./main\";\nimport minimist from \"minimist\";\n// #!/usr/bin/env node\nimport process from \"process\";\nconst argv = minimist(process.argv.slice(2),{string:[\"username\",\"password\"]});\nmain(argv).catch(console.error);\n"],"names":["createhttpauth","options","realm","auth","authentication","user","pass","httpauth","basic","username","password","callback","createbasicauth","digest","utils","md5","createdigestauth","ctx","next","check","req","res","request","response","RIGHTS","getRandomString","length","Array","Math","ceil","map","random","toString","slice","join","__dirname","dirname","fileURLToPath","url","WebdavCli","config","server","auth_middle","constructor","this","getConfig","get_authentication","createhttpauthmiddle","init","selfSignedKey","selfSignedCert","path","process","cwd","host","port","Boolean","ssl","sslKey","fs","readFileSync","sslCert","disableAuthentication","rights","filter","item","includes","userManager","webdav","SimpleUserManager","addUser","privilegeManager","SimplePathPrivilegeManager","setRights","requireAuthentification","httpAuthentication","askForAuthentication","getUser","gotUserCallback","getDefaultUser","defaultUser","hostname","Reflect","set","cert","key","WebDAVServer","beforeRequest","async","headers","method","console","log","setCode","exit","isArray","methodsWithoutAuthentication","arg","depth","publicpath","app","Koa","use","logger","loadcoremiddles","serverHandler","koa_static_server","afterRequest","requested","uri","statusCode","start","Object","fromEntries","entries","setFileSystemAsync","PhysicalFileSystem","logs","rawhttpserver","defineProperty","get","v","on","err","error","listen","round","JSON","stringify","address","enumerable","configurable","startAsync","argv","help","h","r","argvRights","split","undefined","envRights","env","WEBDAV_CLI_RIGHTS","WEBDAV_CLI_PATH","pa","WEBDAV_CLI_HOST","ho","Number","po","parseInt","String","WEBDAV_CLI_PORT","dg","WEBDAV_CLI_DIGEST","WEBDAV_CLI_USERNAME","u","WEBDAV_CLI_PASSWORD","ps","s","WEBDAV_CLI_SSL","WEBDAV_CLI_SSL_KEY","WEBDAV_CLI_SSL_CERT","WEBDAV_CLI_DISABLE_AUTHENTICATION","da","e","webdavCli","run","main","minimist","string","catch"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAKM,SAAUA,EAAeC;IAK3B,MAAMC,IAAQ,iBACRC,IACyB,8BAA3BF,EAAQG,0BCTZF,GACAG,GACAC;QAEA,OAAOC,EAASC,MACZ;YACIN;YAEJ,CAACO,GAAUC,GAAUC;YAEjBA,EAASF,MAAaJ,KAAQK,MAAaJ;AAAK;AAG5D,KDHcM,CAAgBV,GAAOD,EAAQI,MAAMJ,EAAQK,iBERvDJ,GACAG,GACAC;QAEA,OAAOC,EAASM,OACZ;YACIX;YAGJ,CAACO,GAAUE;YACHF,MAAaJ,IACbM,EAASG,EAAMC,IAAI,GAAGN,KAAYP,KAASI,QAE3CK;AACH;AAGb,KFRcK,CAAiBd,GAAOD,EAAQI,MAAMJ,EAAQK;IACxD,OAAO,CAACW,GAAgCC;QACpCf,EAAKgB,OAAM,CAACC,GAAKC;YACbH;AAAM,WADVf,CAEGc,EAAIK,SAASL,EAAIM;AAAS;AAErC;;AGhBO,MAAMC,IAA0B,EACnC,OACA,aACA,aACA,WACA,aACA,aACA,YACA,WACA,aACA,kBACA,cACA,gBACA,cACA,iBACA,wBACA,cACA,eACA,kBACA,kBACA,kBACA,kBACA,oBACA,qBACA,sBACA,0BACA,iBACA;;AC/BE,SAAUC,EAAgBC;IAC5B,OAAO,KAAIC,MAAMC,KAAKC,KAAKH,IAAS,MAC/BI,KAAI,MAAMF,KAAKG,SAASC,SAAS,IAAIC,OAAO,KAC5CC,KAAK,IACLD,OAAOP;AAChB;;ACSA,MACMS,IAAYC,EADCC,cAA0BC;;MAEhCC;IACTC;IACAC;IACAC;IACA,WAAAC,CAAYH;QACRI,KAAKJ,SAASI,MAAKC,EAAWL;QAC9B,MAAMpC,IAAiBwC,MAAKE,EAAoBF,KAAKJ,SAC/CE,aCnBVjC,GACAC,GACAN;YAEA,OAAOJ,EAAe;gBAClBK,MAAMI;gBACNH,MAAMI;gBACNN;;AAER,SDU4B2C,CAChBH,KAAKJ,OAAO/B,UACZmC,KAAKJ,OAAO9B,UACZN;QAEJwC,MAAKF,IAAeA,GACpBE,KAAKH,SAASG,MAAKI;AACtB;IAED,EAAAH,CAAWL;QACP,MAAMS,IAAgBf,EAAKC,GAAW,kCAChCe,IAAiBhB,EACnBC,GACA,mCAGEgB,IAAOX,EAAOW,QAAQC,QAAQC,OAC9BC,IAAOd,EAAOc,QAAQ,WACtBC,IAAOf,EAAOe,QAAQ,MAEtB1C,IAAS2C,QAAQhB,EAAO3B;QAC9B,IAAIJ,KAAY+B,EAAO/B,YAAYgB,EAAgB,KAAKO,YACpDtB,KAAY8B,EAAO9B,YAAYe,EAAgB,KAAKO;QAExD,MAAMyB,IAAMD,QAAQhB,EAAOiB,MACrBC,IAASD,IACTE,EAAGC,aAAapB,EAAOkB,UAAUT,GAAejB,aAChD,IACA6B,IAAUJ,IACVE,EAAGC,aAAapB,EAAOqB,WAAWX,GAAgBlB,aAClD,IAEA8B,IAAwBN,QAAQhB,EAAOsB;QAEzCA,MACAtB,EAAOuB,SAASvB,EAAOuB,UAAU,EAAC,aAClCtD,IAAW,IACXC,IAAW;QAGf,MAAMqD,KAAUvB,EAAOuB,UAAU,EAAC,SAAQC,QACrCC,KAAkCzC,EAAO0C,SAASD,MAEjD3B,IAAM,GAAGmB,IAAM,UAAU,YAAYH,KAAQC;QAEnD,OAAO;eACAf;YACHc;YACAH;YACAI;YACA9C;YACAI;YACAH;YACA+C;YACAI;YACAH;YACAK;YACAzB;YACAwB;;AAEP;IAED,EAAAd;QACI,MAAMR,IAASI,KAAKJ,QAEd2B,IAAc,IAAIC,EAAOC,mBACzBhE,IAAO8D,EAAYG,QACrB9B,EAAO/B,UACP+B,EAAO9B,WACP,IAGE6D,IAAmB,IAAIH,EAAOI;QACpCD,EAAiBE,UAAUpE,GAAM,KAAKmC,EAAOuB;QAE7C,MAAM9D,IAAU;YACZyE,0BAAyB;YACzBC,oBAGI;gBACIC,sBAAsB,OAAO,CAAE;gBAC/BC,SAAS,CACL5D,GACA6D;oBAKAX,EAAYY,gBAAgBC;wBACxBT,EAAiBE,UACbO,GACA,KACAxC,EAAOuB,SAGXe,EAAgB,MAAME;AAAY;AACpC;;YASdzB,MAAMf,EAAOe;YACb0B,UAAUzC,EAAOc;;QAErBd,EAAOiB,OACHyB,QAAQC,IAAIlF,GAAS,SAAS;YAC1BmF,MAAM5C,EAAOqB;YACbwB,KAAK7C,EAAOkB;;QAEpB,MAAMjB,IAAS,IAAI2B,EAAOkB,aAAarF;QAGvC,IADAwC,EAAO8C,eExIJC,OAAOvE,GAAyBC;YACnC,OAAMoB,KAAEA,GAAGmD,SAAEA,GAAOC,QAAEA,KAAWzE,EAAIK;YACrCqE,QAAQC,IAAI,OAAOF,GAAQpD,GAAKmD,IAChCvE;AAAM,aFsIDsB,EAAOsB,uBAsBRrB,EAAO8C,eAAc,CAACtE,GAAKC;YAGnBD,EAAIK,QAAQoE,UAFS,EAAC,OAAO,QAAQ,YAAY,YAGhCxB,SAASjD,EAAIK,QAAQoE,UAEtCxE,OAEAD,EAAI4E,QAAQ;YACZ5E,EAAI6E;AACP,kBAhC0B;YAC/B,MAAMpD,IAAcE,MAAKF;YAErBf,MAAMoE,QAAQnD,KAAKJ,OAAOwD,iCAC1BpD,KAAKJ,OAAOwD,6BAA6BtE,SAEzCe,EAAO8C,eAAc,CAACtE,GAAKC;gBAEnBD,EAAIK,QAAQoE,UACZ9C,KAAKJ,OAAOwD,8BAA8B9B,SACtCjD,EAAIK,QAAQoE,UAGhBxE,MAEAwB,EAAYzB,GAAKC;AACpB,kBAGLuB,EAAO8C,cAAc7C;AAE5B;QAkBD,OAJAD,EAAO8C,eG5KJ,CAACU,GAAyB/E;YAC7B,OAAMuE,SAAEA,GAAOC,QAAEA,KAAWO,EAAI3E,UAC1B4E,OAAEA,KAAUT;YACH,eAAXC,KAAmC,QAAVQ,KAA2B,QAAVA,KAC1CD,EAAIJ,QAAQ,MACZI,EAAIH,UAEJ5E;AACH,aHqKDuB,EAAO8C,cI1KT,SAA4BY;YAC9B,MAAMC,IAAM,IAAIC;YAehBD,EAAIE,IAAIC,MAQRC,EAAgBJ,GAAKD,IAAY;YACjC,MAAMM,IAAgBL,EAAIzF;YAC1B,OAAO,SACHM,GACAC;gBAEA,OAAMI,SAAEA,GAAOC,UAAEA,KAAaN,IACvBG,GAAKC,KAAO,EAACC,GAASC;gBAC7B,IACIN,EAAIK,QAAQoE,WACX,EAAC,OAAO,SAAQxB,SAASjD,EAAIK,QAAQoE,SAEtC,OAAOxE;gBAEXuF,EAAcrF,GAAKC;AAGvB;AACJ,SJgI6BqF,CAAkBlE,EAAOW,QAC9CV,EAAOkE,cK9KJ,CAACV,GAAyB/E;YAC7B,MAAM0E,IAAM,MAAMK,EAAI3E,QAAQoE,UAAUO,EAAIW,UAAUC,SAASZ,EAAI1E,SAASuF;YAE5EnB,QAAQC,IAAIA,IACZ1E;AAAM,aL4KCuB;AACV;IACD,EAAAK,CAAoBN;QAChB,OAAOA,EAAO3B,SACR,6BACA;AACT;IAED,WAAMkG;QACF,MAAMvE,IAASI,KAAKJ,SACdC,QAAEA,KAAWG;QACnB+C,QAAQC,IACJoB,OAAOC,YACHD,OAAOE,QAAQ1E,GAAQwB,QAAO,EAAEqB,QACpB,EAAC,UAAU,YAAWnB,SAASmB;cAI7C5C,EAAO0E,mBACT,KACA,IAAI/C,EAAOgD,mBAAmB5E,EAAOW;QAEzC,MAAMkE,IAAO,EACT,qBAAqB7E,EAAOF,OAE5B,iCACA;QAIJ,IAAIgF;QADJ3B,QAAQC,IAAIyB,EAAKnF,KAAK,QAGtB8E,OAAOO,eAAe9E,GAAQ,UAAU;YACpC+E,KAAG,MACQF;YAEX,GAAAnC,CAAIsC;gBACAH,IAAgBG,GACXH,MAGLA,EAAcI,GAAG,UAAUC;oBACvB,IAAiC,iBAA7BzC,QAAQsC,IAAIG,GAAK,SAMjB,OALAhC,QAAQiC,MAAMD,SACdL,GAAeO,OACXjG,KAAKkG,MAAsB,QAAhBlG,KAAKG,WAChBS,EAAOc;oBAIX,MAAMqE;AACT,qBAELL,EAAcI,GAAG,cAAa;oBAC1B/B,QAAQC,IACJ,yBACImC,KAAKC,UAAUV,GAAeW;AACrC;AAIR;YACDC,aAAY;YACZC,eAAc;kBAGZ1F,EAAO2F,WAAW5F,EAAOe;AAClC;;;CMhPEiC,eACH6C;IAEA1C,QAAQC,IAAI,cAAc,QACtByC,EAAKC,QAAQD,EAAKE,OCRtB5C,QAAQC,IACJ,EACI,+BACA,IACA,YACA,sDACA,8CACA,yCACA,2DACA,uEACA,wEACA,mGACA,0CACA,uFACA,qDACA,sDACA,8CAEA,iEACA,geASA,IACA,QACA,wDACA,kEACA,8DACA,8CACA,uCACA,KACF1D,KAAK;IAEXkB,EAAQ0C;IDvBR,MAAM/B,IAASsE,EAAKtE,UAAUsE,EAAKG,GAC7BC,IACF1E,KAA4B,mBAAXA,IAAsBA,EAAO2E,MAAM,YAAOC,GACzDC,IAAYxF,EAAQyF,IAAIC,oBACxB1F,EAAQyF,IAAIC,kBAAkBJ,MAAM,YACpCC,GACAnG,IAAS;QACXW,MAAMkF,EAAKlF,QAAQC,EAAQyF,IAAIE,mBAAmBV,EAAKW;QACvD1F,MAAM+E,EAAK/E,QAAQF,EAAQyF,IAAII,mBAAmBZ,EAAKa;QACvD3F,MACI4F,OAAOd,EAAK9E,QAAQ8E,EAAKe,OACzBC,SAASC,OAAOlG,EAAQyF,IAAIU;QAChC1I,QACIwH,EAAKxH,UAAUwH,EAAKmB,MAAMhG,QAAQJ,EAAQyF,IAAIY;QAClDhJ,UAAU4H,EAAK5H,YAAY2C,EAAQyF,IAAIa,uBAAuBrB,EAAKsB;QACnEjJ,UAAU2H,EAAK3H,YAAY0C,EAAQyF,IAAIe,uBAAuBvB,EAAKwB;QACnEpG,KAAK4E,EAAK5E,OAAO4E,EAAKyB,KAAKtG,QAAQJ,EAAQyF,IAAIkB;QAC/CrG,QAAQ2E,EAAK3E,UAAUN,EAAQyF,IAAImB;QACnCnG,SAASwE,EAAKxE,WAAWT,EAAQyF,IAAIoB;QACrCnG,uBACIuE,EAAKvE,yBACLV,EAAQyF,IAAIqB,qCACZ7B,EAAK8B;QACTpG,QAAQ0E,KAAcG;QACtB5C,8BACI,mBAAoBqC,EAAKrC,+BACnBsD,OAAOjB,EAAKrC,8BAA8B0C,MAAM,OAChD/G,MAAMoE,QAAQsC,EAAKrC,gCACnBqC,EAAKrC,oCACL2C;;IAYd,OAVAvF,EAAQsE,GAAG,uBAAuB0C;QAE9B,MADAzE,QAAQiC,MAAMwC,IACRA;AAAC,eAEC5E;QAER,MAAM6E,IAAY,IAAI9H,EAAUC;QAEhC,aADM6H,EAAUtD,SACTsD;AAAS,MAEPC;AACjB,EEtDAC,CADaC,EAASpH,EAAQiF,KAAKpG,MAAM,IAAG;IAACwI,QAAO,EAAC,YAAW;IACrDC,MAAM/E,QAAQiC"}